<!DOCTYPE html>
<html lang="en" ng-app="processManagerApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Process Manager</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: #1a1a2e;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
        }
        
        .toolbar {
            padding: 25px;
            background: #16213e;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-box {
            flex: 1;
            min-width: 300px;
        }
        
        .search-box input {
            width: 100%;
            padding: 14px 20px;
            background: #0f3460;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 25px;
            color: white;
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .search-box input::placeholder {
            color: #a8b2d1;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-refresh {
            background: linear-gradient(145deg, #00e676, #00c853);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 230, 118, 0.3);
        }
        
        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 230, 118, 0.5);
        }
        
        .btn-kill {
            background: linear-gradient(145deg, #ff5252, #f44336);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 82, 82, 0.3);
        }
        
        .btn-kill:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(255, 82, 82, 0.5);
        }
        
        .btn-kill:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
        }
        
        .stats-grid {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            background: #16213e;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }
        
        .stat-card {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .stat-card.total {
            background: linear-gradient(145deg, #667eea, #764ba2);
        }
        
        .stat-card.selected {
            background: linear-gradient(145deg, #ffa726, #fb8c00);
        }
        
        .stat-card.memory {
            background: linear-gradient(145deg, #26c6da, #00acc1);
        }
        
        .stat-card h3 {
            font-size: 42px;
            color: white;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .stat-card p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .table-wrapper {
            padding: 25px;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .process-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .process-table thead {
            background: #0f3460;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .process-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #ffffff;
            border-bottom: 2px solid rgba(102, 126, 234, 0.5);
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
        }
        
        .process-table th:hover {
            background: #16213e;
            color: #f093fb;
        }
        
        .process-table td {
            padding: 15px;
            color: #a8b2d1;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
        }
        
        .process-table tbody tr {
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .process-table tbody tr:hover {
            background: #0f3460;
        }
        
        .process-table tbody tr.selected {
            background: rgba(255, 167, 38, 0.2);
            border-left: 4px solid #ffa726;
        }
        
        .checkbox-cell {
            width: 50px;
            text-align: center;
        }
        
        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .process-name {
            color: #ffffff;
            font-weight: 600;
        }
        
        .pid-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            color: #667eea;
            font-size: 12px;
            font-weight: 600;
        }
        
        .memory-high {
            color: #ff5252;
            font-weight: 600;
        }
        
        .memory-medium {
            color: #ffa726;
            font-weight: 600;
        }
        
        .memory-low {
            color: #00e676;
        }
        
        .no-results {
            text-align: center;
            padding: 60px;
            color: #a8b2d1;
        }
        
        .no-results h3 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #ffffff;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
        }
        
        .spinner {
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .sort-icon {
            font-size: 12px;
            margin-left: 5px;
            color: #f093fb;
        }
        
        .alert {
            padding: 15px 25px;
            margin: 20px 25px;
            border-radius: 10px;
            animation: slideIn 0.3s ease;
        }
        
        .alert-success {
            background: rgba(0, 230, 118, 0.2);
            border: 1px solid #00e676;
            color: #00e676;
        }
        
        .alert-error {
            background: rgba(255, 82, 82, 0.2);
            border: 1px solid #ff5252;
            color: #ff5252;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #0f3460;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
        
        .btn-kill-single {
            padding: 8px 16px;
            background: linear-gradient(145deg, #ff5252, #f44336);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 
                3px 3px 10px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(255, 82, 82, 0.2);
        }
        
        .btn-kill-single:hover {
            transform: translateY(-2px);
            box-shadow: 
                5px 5px 15px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(255, 82, 82, 0.4);
        }
        
        .btn-kill-single:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container" ng-controller="ProcessController">
        <div class="header">
            <h1>‚öôÔ∏è Windows Process Manager</h1>
            <p>Monitor and manage running processes in real-time</p>
        </div>
        
        <div class="toolbar">
            <div class="search-box">
                <input 
                    type="text" 
                    ng-model="searchText" 
                    placeholder="üîç Search processes by name, PID, or session...">
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-refresh" ng-click="refreshProcesses()">
                    ‚Üª Refresh
                </button>
                <button 
                    class="btn btn-kill" 
                    ng-click="killSelectedProcesses()"
                    ng-disabled="getSelectedCount() === 0">
                    ‚úñ Kill Selected ({{getSelectedCount()}})
                </button>
            </div>
        </div>
        
        <div class="alert alert-success" ng-show="successMessage">
            {{successMessage}}
        </div>
        
        <div class="alert alert-error" ng-show="errorMessage">
            {{errorMessage}}
        </div>
        
        <div class="stats-grid">
            <div class="stat-card total">
                <h3>{{processes.length}}</h3>
                <p>Total Processes</p>
            </div>
            <div class="stat-card selected">
                <h3>{{getSelectedCount()}}</h3>
                <p>Selected</p>
            </div>
            <div class="stat-card memory">
                <h3>{{getTotalMemory()}}</h3>
                <p>Total Memory</p>
            </div>
        </div>
        
        <div class="table-wrapper">
            <div ng-show="loading" class="loading">
                <div class="spinner"></div>
                <p style="color: #a8b2d1;">Loading processes...</p>
            </div>
            
            <table class="process-table" ng-show="!loading">
                <thead>
                    <tr>
                        <th class="checkbox-cell">
                            <input 
                                type="checkbox" 
                                ng-model="selectAll" 
                                ng-change="toggleSelectAll()">
                        </th>
                        <th ng-click="sortBy('name')">
                            Process Name
                            <span class="sort-icon" ng-show="sortColumn === 'name'">
                                {{sortReverse ? '‚ñº' : '‚ñ≤'}}
                            </span>
                        </th>
                        <th ng-click="sortBy('pid')">
                            PID
                            <span class="sort-icon" ng-show="sortColumn === 'pid'">
                                {{sortReverse ? '‚ñº' : '‚ñ≤'}}
                            </span>
                        </th>
                        <th ng-click="sortBy('sessionName')">
                            Session Name
                            <span class="sort-icon" ng-show="sortColumn === 'sessionName'">
                                {{sortReverse ? '‚ñº' : '‚ñ≤'}}
                            </span>
                        </th>
                        <th ng-click="sortBy('memoryUsage')">
                            Memory Usage
                            <span class="sort-icon" ng-show="sortColumn === 'memoryUsage'">
                                {{sortReverse ? '‚ñº' : '‚ñ≤'}}
                            </span>
                        </th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="process in filteredProcesses() | orderBy:sortColumn:sortReverse"
                        ng-class="{selected: process.selected}"
                        ng-click="toggleSelection(process)">
                        <td class="checkbox-cell">
                            <input 
                                type="checkbox" 
                                ng-model="process.selected"
                                ng-click="$event.stopPropagation()">
                        </td>
                        <td class="process-name">{{process.name}}</td>
                        <td><span class="pid-badge">{{process.pid}}</span></td>
                        <td>{{process.sessionName}}</td>
                        <td ng-class="{
                            'memory-high': getMemoryValue(process.memoryUsage) > 100000,
                            'memory-medium': getMemoryValue(process.memoryUsage) > 50000 && getMemoryValue(process.memoryUsage) <= 100000,
                            'memory-low': getMemoryValue(process.memoryUsage) <= 50000
                        }">
                            {{process.memoryUsage}}
                        </td>
                        <td>
                            <button 
                                class="btn-kill-single" 
                                ng-click="killSingleProcess(process); $event.stopPropagation()">
                                ‚úñ Kill
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div ng-show="!loading && filteredProcesses().length === 0" class="no-results">
                <h3>No Processes Found</h3>
                <p>Try adjusting your search criteria</p>
            </div>
        </div>
    </div>

    <script>
        var app = angular.module('processManagerApp', []);
        
        app.controller('ProcessController', function($scope, $timeout) {
            $scope.processes = [];
            $scope.searchText = '';
            $scope.loading = true;
            $scope.sortColumn = 'name';
            $scope.sortReverse = false;
            $scope.selectAll = false;
            $scope.successMessage = '';
            $scope.errorMessage = '';
            
            $scope.loadProcesses = function() {
                $scope.loading = true;
                
                // Fetch actual process data from REST API
                fetch('http://localhost:8080/api/processes')
                    .then(response => response.json())
                    .then(data => {
                        $scope.$apply(function() {
                            $scope.processes = data.map(p => ({
                                name: p.name,
                                pid: p.pid,
                                sessionName: p.sessionName,
                                memoryUsage: p.memoryUsage,
                                selected: false
                            }));
                            $scope.loading = false;
                        });
                    })
                    .catch(error => {
                        console.error('Error loading processes:', error);
                        $scope.$apply(function() {
                            $scope.errorMessage = 'Failed to load processes. Make sure the REST API server is running on port 8080.';
                            $scope.loading = false;
                        });
                    });
            };
            
            $scope.filteredProcesses = function() {
                return $scope.processes.filter(function(process) {
                    if (!$scope.searchText) return true;
                    
                    var search = $scope.searchText.toLowerCase();
                    return process.name.toLowerCase().includes(search) ||
                           process.pid.includes(search) ||
                           process.sessionName.toLowerCase().includes(search);
                });
            };
            
            $scope.sortBy = function(column) {
                if ($scope.sortColumn === column) {
                    $scope.sortReverse = !$scope.sortReverse;
                } else {
                    $scope.sortColumn = column;
                    $scope.sortReverse = false;
                }
            };
            
            $scope.toggleSelection = function(process) {
                process.selected = !process.selected;
            };
            
            $scope.toggleSelectAll = function() {
                var filtered = $scope.filteredProcesses();
                filtered.forEach(function(process) {
                    process.selected = $scope.selectAll;
                });
            };
            
            $scope.getSelectedCount = function() {
                return $scope.processes.filter(function(p) { 
                    return p.selected; 
                }).length;
            };
            
            $scope.getTotalMemory = function() {
                var total = 0;
                $scope.processes.forEach(function(p) {
                    total += $scope.getMemoryValue(p.memoryUsage);
                });
                return Math.round(total / 1024) + ' MB';
            };
            
            $scope.getMemoryValue = function(memStr) {
                return parseInt(memStr.replace(/[^0-9]/g, '')) || 0;
            };
            
            $scope.killSelectedProcesses = function() {
                var selected = $scope.processes.filter(function(p) { return p.selected; });
                
                if (selected.length === 0) return;
                
                if (confirm('Are you sure you want to kill ' + selected.length + ' process(es)?')) {
                    $scope.errorMessage = '';
                    var killPromises = [];
                    
                    selected.forEach(function(process) {
                        var promise = fetch('http://localhost:8080/api/process/kill', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                pid: process.pid,
                                processName: process.name
                            })
                        }).then(response => response.json());
                        
                        killPromises.push(promise);
                    });
                    
                    Promise.all(killPromises).then(results => {
                        $scope.$apply(function() {
                            var successCount = results.filter(r => r.success).length;
                            var failCount = results.length - successCount;
                            
                            if (successCount > 0) {
                                $scope.successMessage = 'Successfully killed ' + successCount + ' process(es)';
                            }
                            if (failCount > 0) {
                                $scope.errorMessage = 'Failed to kill ' + failCount + ' process(es). Administrator privileges may be required.';
                            }
                            
                            setTimeout(function() {
                                $scope.$apply(function() {
                                    $scope.successMessage = '';
                                    $scope.errorMessage = '';
                                });
                            }, 5000);
                            
                            $scope.loadProcesses();
                        });
                    }).catch(error => {
                        $scope.$apply(function() {
                            $scope.errorMessage = 'Error: ' + error.message;
                        });
                    });
                }
            };
            
            $scope.killSingleProcess = function(process) {
                if (confirm('Kill process: ' + process.name + ' (PID: ' + process.pid + ')?')) {
                    fetch('http://localhost:8080/api/process/kill', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            pid: process.pid,
                            processName: process.name
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        $scope.$apply(function() {
                            if (data.success) {
                                $scope.successMessage = data.message;
                                $scope.loadProcesses();
                            } else {
                                $scope.errorMessage = data.message;
                            }
                            
                            setTimeout(function() {
                                $scope.$apply(function() {
                                    $scope.successMessage = '';
                                    $scope.errorMessage = '';
                                });
                            }, 5000);
                        });
                    })
                    .catch(error => {
                        $scope.$apply(function() {
                            $scope.errorMessage = 'Error: ' + error.message;
                        });
                    });
                }
            };
            
            $scope.refreshProcesses = function() {
                $scope.successMessage = '';
                $scope.errorMessage = '';
                $scope.selectAll = false;
                $scope.loadProcesses();
            };
            
            // Initial load
            $scope.loadProcesses();
        });
    </script>
</body>
</html>
